# Руководство для разработчика (Onboarding Guide)

Привет! Если ты читаешь этот файл, вероятно, у тебя есть около года опыта разработки (Junior/Junior+), и ты хочешь разобраться, как устроен этот проект, почему код написан именно так и куда расти дальше.

Этот гайд написан специально для того, чтобы закрыть пробелы между теорией и практикой в контексте этого проекта.

## 1. С чего начать изучение кода?

Не пытайся читать всё подряд. Порядок погружения:

1.  **`App.xaml` / `App.xaml.cs`**: Точка входа. Посмотри, как запускается приложение. Но здесь ничего интересного.
2.  **`Views/MainWindow.xaml.cs`**: Посмотри конструктор. Ты увидишь, как создаются классы ("Composition Root").
    ```csharp
    // Мы вручную создаем зависимости и передаем их друг другу.
    // Это называется "Dependency Injection" (внедрение зависимостей), но сделанное вручную ("Pure DI").
    _configManager = new ConfigManager();
    _fileSorterService = new FileSorterService(_configManager);
    ```
3.  **`Services/FileSorterService.cs`**: Это самая важная часть. Изучи метод `Start()` и событие `OnFileCreated`.

## 2. Ключевые концепции и "грабли"

### Асинхронность и FileSystemWatcher
Ты увидишь такой код:
```csharp
Task.Delay(1000).ContinueWith(_ => TrySortFile(e.FullPath));
```
**Почему так?**
Когда файл появляется в папке, он может быть еще занят (например, браузер докачивает файл). Если мы попытаемся переместить его сразу (`File.Move`), получим ошибку `IOException`.
Мы ждем секунду и пробуем. Если не вышло — ждем еще.
*Совет*: В "кровавом энтерпрайзе" для этого используют библиотеки типа `Polly` (для Retry-политик), но здесь простая рекурсия с задержкой работает достаточно хорошо.

### WPF и потоки (Dispatcher)
В `MainViewModel.cs` ты увидишь:
```csharp
App.Current.Dispatcher.Invoke(() => {
    Logs.Insert(0, message);
});
```
**Зачем?**
WPF (как и WinForms) однопоточный в плане UI. Изменять кнопки/текст можно ТОЛЬКО из главного потока.
События сортировки приходят из фонового потока. Если убрать `Dispatcher.Invoke`, приложение "упадет" с ошибкой кросс-поточного доступа.

### MVVM (Model-View-ViewModel)
Если ты работал с WinForms, ты привык писать `textBox1.Text = "Hello"`.
В WPF мы так не делаем. Мы создаем свойство в классе ViewModel:
```csharp
public string MyText { get; set; } // + INotifyPropertyChanged
```
И в XAML пишем: `Text="{Binding MyText}"`.
Это позволяет менять дизайн, не ломая логику C#.

## 3. Что можно улучшить? (Задачи для роста)

Если хочешь прокачать навык ("набить руку"), попробуй сделать следующее:

1.  **Внедрение DI-контейнера**:
    Сейчас мы создаем классы через `new`. Попробуй подключить `Microsoft.Extensions.DependencyInjection` и настраивать сервисы там. Это стандарт индустрии.

2.  **Логирование**:
    Сейчас мы пишем логи просто в список в окне. Подключи `Serilog` или `NLog`, чтобы логи писались в текстовый файл. Это поможет отлаживать ошибки у пользователей.

3.  **Unit-тесты**:
    Попробуй написать тест для `ConfigManager`. Проверь, что он правильно возвращает папку для расширения `.jpg`. Для этого создай проект xUnit.

4.  **Улучшение архитектуры**:
    В `FileSorterService` есть жесткая зависимость от `ConfigManager`.
    *Уровень PRO*: Выдели интерфейс `IConfigManager` и используй его. Это позволит подменять настройки в тестах.

## 4. Полезные ресурсы

- **Microsoft Learn (WPF)**: Официальная документация очень хороша.
- **Source Making (Patterns)**: Если хочешь глубже понять паттерн Observer (События) или Singleton.
- **Metanit (C#)**: Отличный ресурс на русском языке по основам C# и WPF.

Удачи в изучении! Главное в первый год — не бояться читать чужой код и спрашивать "почему это работает именно так?".

